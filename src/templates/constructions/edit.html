{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% block title %}IDEAL_ASP{% endblock %}
{% block style %}<link rel="stylesheet" type="text/css" href="{% static 'css/constructions/edit.css' %}"><link rel="stylesheet" type="text/css" href="{% static 'css/constructions/detail.css' %}">{% endblock %}
{% block content %}
<div id="sideBar_wrapper" class="sideBar">
    {% include "side-bar.html" %}
</div>
{% with construction=construction_form.instance %}
<div class="d-flex flex-row flex-wrap">
    <main class="col-12">
        <div id="_message-box" class="{{ alert_type }}">{{ alert_message }}</div>
        <div class="pc">
            {% if construction_form.id.value %}
            <form action="{% url 'constructions:construction_edit' construction_form.id.value %}" method="POST" id="construction_form">
            {% else %}
            <form action="{% url 'constructions:construction_add' construction_form.instance.client.id %}" method="POST" id="construction_form">
            {% endif %}
                {% csrf_token %}
                {{construction_form.id}}
                {{construction_form.sp}}
                <div class="container1">
                    <div class="row">
                        <div class="table-responsive col-sm-6 col-12">
                            <table class="table table-striped text-nowrap">
                                <tbody>
                                    <tr>
                                        <th>工事番号</th>
                                        <td>
                                          {{construction.code}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>案件種別</th>
                                        <td>
                                          {{construction_form.project_type}}
                                          {{construction_form.project_type.errors}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>継続・新規</th>
                                        <td>
                                          {{construction_form.renew_status}}
                                          {{construction_form.renew_status.errors}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>物件規模</th>
                                        <td>
                                          {{construction_form.scale_type}}
                                          {{construction_form.scale_type.errors}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>工事件名</th>
                                        <td>
                                          {{construction_form.name}}
                                          {{construction_form.name.errors}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>現場住所</th>
                                        <td>
                                          {{construction_form.site_address}}
                                          {{construction_form.site_address.errors}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>契約者住所</th>
                                        <td>
                                          {{construction_form.contractor_address}}
                                          {{construction_form.contractor_address.errors}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>契約者名</th>
                                        <td>
                                          {{construction_form.contractor_name}}
                                          {{construction_form.contractor_name.errors}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>連絡先TEL</th>
                                        <td>
                                          {{construction_form.contact_tel}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>該当顧客データ</th>
                                        <td>
                                          {{construction_form.instance.client.code}}
                                            <button type="button" class="search_btn btn-outline-dark mb-2" id="load-client-data-btn"><i class="fas fa-sync-alt"></i>更新</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>顧客名</th>
                                        <td>
                                          {{construction_form.client_name}}
                                          {{construction_form.client_name.errors}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>TEL</th>
                                        <td>
                                          {{construction_form.client_tel}}
                                          {{construction_form.client_tel.errors}}
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>顧客住所</th>
                                        <td>
                                          {{construction_form.client_address}}
                                          {{construction_form.client_address.errors}}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="table-responsive col-sm-6 col-12">
                            <table class="table table-bordered table-striped text-nowrap">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>名前</th>
                                        <th>％</th>
                                        <th>個人別売上</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th>営業担当１</th>
                                        <td>
                                          {{construction_form.sales1_user}}
                                          {{construction_form.sales1_user.errors}}
                                        </td>
                                        <td>
                                          {{construction_form.sales1_ratio}} %
                                          {{construction_form.sales1_ratio.errors}}
                                        </td>
                                        <td>{{construction.latest_sales1_sales_amount|intcomma}} 円</td>
                                    </tr>
                                    <tr>
                                        <th>営業担当２</th>
                                        <td>
                                          {{construction_form.sales2_user}}
                                          {{construction_form.sales2_user.errors}}
                                        </td>
                                        <td>
                                          {{construction_form.sales2_ratio}} %
                                          {{construction_form.sales2_ratio.errors}}
                                        </td>
                                        <td>{{construction.latest_sales2_sales_amount|intcomma}} 円</td>
                                    </tr>
                                    <tr>
                                        <th>現場担当１</th>
                                        <td>
                                          {{construction_form.site1_user}}
                                          {{construction_form.site1_user.errors}}
                                        </td>
                                        <td>
                                          {{construction_form.site1_ratio}} %
                                          {{construction_form.site1_ratio.errors}}
                                        </td>
                                        <td>{{construction.latest_site1_sales_amount|intcomma}} 円</td>
                                    </tr>
                                    <tr>
                                        <th>現場担当２</th>
                                        <td>
                                          {{construction_form.site2_user}}
                                          {{construction_form.site2_user.errors}}
                                        </td>
                                        <td>
                                          {{construction_form.site2_ratio}} %
                                          {{construction_form.site2_ratio.errors}}
                                        </td>
                                        <td>{{construction.latest_site2_sales_amount|intcomma}} 円</td>
                                    </tr>
                                    <tr>
                                        <th>設計担当</th>
                                        <td>
                                          {{construction_form.design_user}}
                                          {{construction_form.design_user.errors}}
                                        </td>
                                        <td>
                                          {{construction_form.design_ratio}} %
                                          {{construction_form.design_ratio.errors}}
                                        </td>
                                        <td>{{construction.latest_design_sales_amount|intcomma}} 円</td>
                                    </tr>
                                    <tr>
                                        <th>積算担当</th>
                                        <td>
                                          {{construction_form.accountant_user}}
                                          {{construction_form.accountant_user.errors}}
                                        </td>
                                        <td>
                                          {{construction_form.accountant_ratio}} %
                                          {{construction_form.accountant_ratio.errors}}
                                        </td>
                                        <td>{{construction.latest_accountant_sales_amount|intcomma}} 円</td>
                                    </tr>
                                    <tr>
                                        <th>担当A</th>
                                        <td>
                                          {{construction_form.charge_a_user}}
                                          {{construction_form.charge_a_user.errors}}
                                        </td>
                                        <td>
                                          {{construction_form.charge_a_ratio}} %
                                          {{construction_form.charge_a_ratio.errors}}
                                        </td>
                                        <td>{{construction.latest_charge_a_sales_amount|intcomma}} 円</td>
                                    </tr>
                                    <tr>
                                        <th>担当B</th>
                                        <td>
                                          {{construction_form.charge_b_user}}
                                          {{construction_form.charge_b_user.errors}}
                                        </td>
                                        <td>
                                          {{construction_form.charge_b_ratio}} %
                                          {{construction_form.charge_b_ratio.errors}}
                                        </td>
                                        <td>{{construction.latest_charge_b_sales_amount|intcomma}} 円</td>
                                    </tr>
                                    <tr>
                                        <th>担当C</th>
                                        <td>
                                          {{construction_form.charge_c_user}}
                                          {{construction_form.charge_c_user.errors}}
                                        </td>
                                        <td>
                                          {{construction_form.charge_c_ratio}} %
                                          {{construction_form.charge_c_ratio.errors}}
                                        </td>
                                        <td>{{construction.latest_charge_c_sales_amount|intcomma}} 円</td>
                                    </tr>
                                    <tr>
                                        <th>担当D</th>
                                        <td>
                                          {{construction_form.charge_d_user}}
                                          {{construction_form.charge_d_user.errors}}
                                        </td>
                                        <td>
                                          {{construction_form.charge_d_ratio}} %
                                          {{construction_form.charge_d_ratio.errors}}
                                        </td>
                                        <td>{{construction.latest_charge_d_sales_amount|intcomma}} 円</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% comment %}
                <div class="popup">
                    <div class="content_pop">
                        <p>保存が完了しました。</p>
                        <button id="close">閉じる</button>
                    </div>
                </div>
                {% endcomment %}
                {% if construction_form.id.value %}
                <div class="progress_container">
                    <div class="row">
                        <div class="col-12 col-sm-2">
                            <p>工事別売上進捗</p>
                        </div>
                        <div class="col-12 col-sm-10">
                            <div class="progress">
                                <div class="progress-bar bg-warning" role="progressbar" aria-valuenow="{{construction.latest_progress}}" aria-valuemin="0" aria-valuemax="100" style="width:{{construction.latest_progress}}%;">{{construction.latest_progress}}%</div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="row">
                    <div class="table-responsive col-12 col-md-3">
                        <table class="table table-striped text-nowrap">
                            <tbody>
                                <tr>
                                    <th>進行状況</th>
                                    <td>
                                        {{construction_form.progress_status}}
                                        {{construction_form.progress_status.errors}}
                                    </td>
                                </tr>
                                {% if construction_form.id.value %}
                                <tr>
                                    <th>受注金額</th>
                                    <td>
                                        {{construction.contract_amount|intcomma}} 円
                                    </td>
                                </tr>
                                <tr>
                                    <th>請求金額</th>
                                    <td>
                                        {{construction.billing_amount|intcomma}} 円
                                    </td>
                                </tr>
                                <tr>
                                    <th>未収金額</th>
                                    <td>
                                        {{construction.uncollected_amount|intcomma}} 円
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>

                        <table class="table table-striped text-nowrap">
                            <tbody>
                                {% if construction_form.id.value %}
                                <tr>
                                    <th>材料費(税別)</th>
                                    <td>
                                        {{construction.material_fee_without_tax|intcomma}} 円
                                    </td>
                                </tr>
                                <tr>
                                    <th>外注費(税別)</th>
                                    <td>
                                        {{construction.outsource_fee_without_tax|intcomma}} 円
                                    </td>
                                </tr>
                                <tr>
                                    <th>小口経費</th>
                                    <td>
                                        {{construction.small_expense|intcomma}} 円
                                    </td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <th>現場管理費</th>
                                    <td>
                                        {{construction_form.management_fee}} 円
                                        {{construction_form.management_fee.errors}}
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                    <div class="table-responsive col-12 col-md-3">
                        <table class="table table-striped text-nowrap">
                            <tbody>
                                <tr>
                                    <th>計画原価</th>
                                    <td>
                                        {{construction_form.planned_cost}} 円
                                        {{construction_form.planned_cost.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>予定工事日数</th>
                                    <td>
                                        {{construction_form.planned_days}} 日
                                        {{construction_form.planned_days.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>計画粗利率</th>
                                    <td>
                                        {{construction_form.planned_gross_profit}} %
                                        {{construction_form.planned_gross_profit.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>計画日割粗利</th>
                                    <td>
                                        {{construction_form.planned_gross_per_day}} 円/日
                                        {{construction_form.planned_gross_per_day.errors}}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        {% if construction_form.id.value %}
                        <table class="table table-striped text-nowrap">
                            <tbody>
                                <tr>
                                    <th>原価</th>
                                    <td>
                                        {{construction.cost|intcomma}} 円
                                    </td>
                                </tr>
                                <tr>
                                    <th>粗利差額</th>
                                    <td>
                                        {{construction.gross_balance|intcomma}} 円
                                    </td>
                                </tr>
                                <tr>
                                    <th>粗利率</th>
                                    <td>
                                        {{construction.gross_profit}} %
                                    </td>
                                </tr>
                                <tr>
                                    <th>日割粗利</th>
                                    <td>
                                        {{construction.gross_per_day|intcomma}} 円/日
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        {% endif %}
                    </div>
                    <div class="table-responsive col-12 col-md-3">
                        <table class="table table-striped text-nowrap">
                            <tbody>
                                <tr>
                                    <th>契約日</th>
                                    <td>
                                        {{construction_form.contract_date}}
                                        {{construction_form.contract_date.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>着工日</th>
                                    <td>
                                        {{construction_form.start_date}}
                                        {{construction_form.start_date.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>竣工日</th>
                                    <td>
                                        {{construction_form.end_date}}
                                        {{construction_form.end_date.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>請求日</th>
                                    <td>
                                        {{construction_form.billing_date}}
                                        {{construction_form.billing_date.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>完工入金日</th>
                                    <td>
                                        {{construction_form.payment_date}}
                                        {{construction_form.payment_date.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>不成立日</th>
                                    <td>
                                        {{construction_form.failure_date}}
                                        {{construction_form.failure_date.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>点検日</th>
                                    <td>
                                        {{construction_form.inspection_date}}
                                        {{construction_form.inspection_date.errors}}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <table class="table table-striped text-nowrap">
                            <tbody>
                                <tr>
                                    <th>契約書用税率</th>
                                    <td>
                                        {{construction_form.contract_tax_rate}} %
                                        {{construction_form.contract_tax_rate.errors}}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="table-responsive col-12 col-md-3">
                        <table class="table table-striped text-nowrap">
                            <tbody>
                                <tr>
                                    <th>契約予定日</th>
                                    <td>
                                        {{construction_form.expected_contract_date}}
                                        {{construction_form.expected_contract_date.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>着工予定日</th>
                                    <td>
                                        {{construction_form.expected_start_date}}
                                        {{construction_form.expected_start_date.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>竣工予定日</th>
                                    <td>
                                        {{construction_form.expected_end_date}}
                                        {{construction_form.expected_end_date.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>完工予定日</th>
                                    <td>
                                        {{construction_form.expected_payment_date}}
                                        {{construction_form.expected_payment_date.errors}}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="table-responsive col-12 col-md-12">
                        <div class="wrapper_button">
                            <a href="{% url 'constructions:index' %}">
                              <button type="button" class="btn btn-outline-warning btn-md"><i class="sub-icon fas fa-angle-double-left"></i>戻る</button>
                            </a>
                            <button type="submit" class="btn btn-outline-warning btn-md btn_save" id="consrction-save-btn"><i class="sub-icon fas fa-file-export"></i>保存</button>
                            {% if construction_form.id.value %}
                            <button type="button" class="btn btn_delete btn-outline-warning btn-md" id="construction-delete-btn"><i class="sub-icon fas fa-trash-alt"></i>消去</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <!-- Modal -->
                <div class="modal fade" id="failureReasonModal" tabindex="-1" role="dialog" aria-labelledby="failureReasonModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document" style="max-width: 650px;">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="failureReasonModalLabel">不成立理由</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <div id="_message-box-failure_reason" class="{{ alert_type }}">{{ alert_message }}</div>
                          <table class="table table-striped table-bordered text-nowrap">
                            <tbody>
                                <tr>
                                    <th>理由区分</th>
                                    <td>
                                      {{construction_form.failure_reason_type}}
                                      {{construction_form.failure_reason_type.errors}}
                                    </td>
                                </tr>
                                <tr>
                                    <th>備考</th>
                                    <td>
                                      {{construction_form.failure_reason_description}}
                                      {{construction_form.failure_reason_description.errors}}
                                    </td>
                                </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="modal-footer">
                          <div class"center-block" style="width: 100%; text-align: center;">
                            <button type="submit" class="btn btn-outline-warning btn-md btn_save _jsFailureReasonUpdateBtn"><i class="sub-icon fas fa-file-export"></i>保存</button>
                          </div>
                        </div>
                      </div>
                  </div>
                </div>
            </form>
            {% if construction_form.id.value %}
            <div class="wrapper_button2">
                <a href="{% url 'estimates:create' construction_form.id.value  %}">
                  <button type="button" class="btn btn-outline-warning btn-md"><i class="sub-icon fas fa-file-alt"></i>新規見積書作成</button>
                </a>
                <a href="{% url 'invoices:create' construction_form.id.value  %}">
                  <button type="button" class="btn btn-outline-warning btn-md"><i class="sub-icon fas fa-file-alt"></i>新規請求書作成</button>
                </a>
                <a href="{% url 'contracts:create' construction_form.id.value  %}">
                  <button type="button" class="btn btn-outline-warning btn-md"><i class="sub-icon fas fa-file-alt"></i>新規契約書作成</button>
                </a>
                <a href="{% url 'merchandise_orders:create' construction_form.id.value %}">
                  <button type="button" class="btn btn-outline-warning btn-md"><i class="sub-icon fas fa-file-alt"></i>新規商品発注書作成</button>
                </a>
                <a href="{% url 'outsource_orders:create' construction_form.id.value  %}">
                  <button type="button" class="btn btn-outline-warning btn-md"><i class="sub-icon fas fa-file-alt"></i>新規外注発注書作成</button>
                </a>
            </div>
            <div class="p-6">
                {% include "constructions/construction-tab.html" with construction_form=construction_form construction_id=construction_form.id.value%}
            </div>
            {% endif %}
        </div>
        <div class="phone">
            {% if sp_construction_form.id.value %}
            <form action="{% url 'constructions:construction_edit' sp_construction_form.id.value %}" method="POST" id="sp_construction_form">
            {% else %}
            <form action="{% url 'constructions:construction_add' sp_construction_form.instance.client.id %}" method="POST" id="sp_construction_form">
            {% endif %}
                {% csrf_token %}
                {{sp_construction_form.id}}
                {{sp_construction_form.sp}}
               <a href="index"><button type="button" id="back" class="btn btn-outline-warning btn-md"><i class="sub-icon fas fa-angle-double-left"></i>戻る</button></a>
                <div class="table-responsive col-sm-6 col-12">
                    <table class="table table-striped text-nowrap">
                        <tbody>
                            <tr>
                                <th>工事番号</th>
                                <td>{{construction.code}}</td>
                            </tr>
                            <tr>
                                <th>進行状況</th>
                                <td>{{sp_construction_form.progress_status}}</td>
                            </tr>
                            <tr>
                                <th>営業担当１</th>
                                <td>{{sp_construction_form.sales1_user}}</td>
                            </tr>
                            <tr>
                                <th>現場担当１</th>
                                <td>{{sp_construction_form.site1_user}}</td>
                            </tr>
                            <tr>
                                <th>案件名</th>
                                <td>{{sp_construction_form.name}}</td>
                            </tr>
                            <tr>
                                <th>顧客名</th>
                                <td>{{sp_construction_form.client_name}}</td>
                            </tr>
                            <tr>
                                <th>予定日</th>
                                <td>{{sp_construction_form.start_date}}</td>
                            </tr>
                            <tr>
                                <th>竣工日</th>
                                <td>{{sp_construction_form.end_date}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="wrapper_button">
                    <button type="button" class="btn btn-outline-warning btn-md btn_save" id="sp-construction-save-btn"><i class="sub-icon fas fa-file-export"></i>保存</button>
                    {% if sp_construction_form.id.value %}
                    <button type="button" class="btn btn_delete btn-outline-warning btn-md" id="sp-construction-delete-btn"><i class="sub-icon fas fa-trash-alt"></i>消去</button>
                    {% endif %}
                </div>
            </form>
            {% if sp_construction_form.id.value %}
              <p>■新規追加</p>
              <div id="sp_schedule_add_message-box" class="{{ alert_type }}">{{ alert_message }}</div>
              <div class="form_area">
                <form action="{% url 'constructions:sp_schedule_add' sp_construction_form.id.value %}" method="POST" id="sp_schedule_add_form">
                  {% csrf_token %}
                  <div class="row">
                      {{sp_schedule_add_form.description}}
                      {{sp_schedule_add_form.description.errors}}
                  </div>
                  <div class="row">
                      {{sp_schedule_add_form.expected_date}}
                      {{sp_schedule_add_form.expected_date.errors}}
                  </div>
                  <div class="row">
                      {{sp_schedule_add_form.charge_user}}
                      {{sp_schedule_add_form.charge_user.errors}}
                  </div>
                  <div class="wrapper_button">
                    <button type="button" class="btn btn_add btn-outline-warning btn-md" id="sp-schedule-add-btn"><i class="sub-icon fas fa-plus-circle"></i>追加</button>
                  </div>
                </form>
              </div>
              <p>■一覧</p>
              <div id="sp_schedule_save_message-box" class="{{ alert_type }}">{{ alert_message }}</div>
              <div class="table-responsive">
                  <form action="{% url 'constructions:sp_schedule_save' sp_construction_form.id.value %}" method="post" id="sp_schedule_edit_form">
                      {% csrf_token %}
                      <input type="hidden" name="id">
                      {{ sp_schedule_edit_form.charge_user.as_hidden }}
                  </form>
                  <table class="table table-striped table-bordered text-nowrap">
                      <thead>
                          <tr>
                              <th>STEP</th>
                              <th>予約内容</th>
                              <th>予定日</th>
                              <th>担当者</th>
                              <th>完了</th>
                          </tr>
                      </thead>
                      <tbody>
                          {% for sp_schedule in construction.construction_schedules %}
                            <tr>
                                <input type="hidden"  name="schedule_id" value="{{ sp_schedule.id }}">
                                <td>STEP{{ forloop.counter }}</td>
                                <td>
                                  {{sp_schedule.description}}
                                </td>
                                <td>
                                  {{sp_schedule.expected_date}}
                                </td>
                                <td>
                                  <select name="charge_user_id" class="SlectBox _jsSpScheduleChangeChargeUser" required >
                                      <option disable value="">担当者</option>
                                      {% for user in users %}
                                          {% if user.id == sp_schedule.charge_user_id %}
                                              <option selected value="{{ user.id }}">{{ user.name }}</option>
                                          {% else %}
                                              <option value="{{ user.id }}">{{ user.name }}</option>
                                          {% endif %}
                                      {% endfor %}
                                  </select>
                                </td>
                                <td>
                                  {% if sp_schedule.finished_flag == 0 %}
                                  <button type="button" class="btn_table btn-outline-dark btn-sm _jsSpScheduleStatusBtnClick" ><i class="fas fa-check"></i>完了</button>
                                  {% else %}
                                  <button type="button" class="btn_table btn-outline-dark btn-sm" disabled ><i class="fas fa-check"></i>完了済</button>
                                  {% endif %}
                                </td>
                            </tr>
                          {% endfor %}
                      </tbody>
                  </table>
              </div>
          {% endif %}
        </div>
    </main>
</div>
{% endwith %}
{% endblock %}
{% block script %}
<script type="text/javascript" src="{% static 'js/constructions/edit.js' %}"></script>
<script type="text/javascript">
    {% autoescape off %}
    let latest_client_data = JSON.parse('{{construction_form.instance.latest_client_json_data}}');
    {% endautoescape %}
</script>
{% endblock %}
